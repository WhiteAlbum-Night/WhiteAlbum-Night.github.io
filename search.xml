<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Linux下安装和卸载plsql</title>
    <url>/post/acd51c99.html</url>
    <content><![CDATA[<p>首先在VMWare安装CentOS7, 参考此篇文章</p>
<p><code>https://blog.csdn.net/babyxue/article/details/80970526</code></p>
<h4 id="卸载plsql"><a href="#卸载plsql" class="headerlink" title="卸载plsql"></a>卸载plsql</h4><p>输入: <code>yum remove postgresql*</code> 系统自动执行删除操作</p>
<h4 id="安装plsql"><a href="#安装plsql" class="headerlink" title="安装plsql"></a>安装plsql</h4><p>到plsql官网: <a href="https://www.postgresql.org/">https://www.postgresql.org/</a>  点击下载, 选择对应的系统和版本, 如图</p>
<p><img src="/images/test.png" alt="test.png"></p>
<p>选择完后会出现官方给的安装命令</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sudo yum install -y https:<span class="regexp">//</span>download.postgresql.org<span class="regexp">/pub/</span>repos<span class="regexp">/yum/</span>reporpms<span class="regexp">/EL-7-x86_64/</span>pgdg-redhat-repo-latest.noarch.rpm</span><br><span class="line">sudo yum install -y postgresql13-server</span><br><span class="line">sudo <span class="regexp">/usr/</span>pgsql-<span class="number">13</span><span class="regexp">/bin/</span>postgresql-<span class="number">13</span>-setup initdb</span><br><span class="line">sudo systemctl enable postgresql-<span class="number">13</span></span><br><span class="line">sudo systemctl start postgresql-<span class="number">13</span></span><br></pre></td></tr></table></figure>

<p>执行initdb的时候可能会遇到如下问题</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>pgsql-<span class="number">13</span><span class="regexp">/bin/</span>postgresql-<span class="number">13</span>-setup initdb</span><br><span class="line">Data directory is not empty!</span><br></pre></td></tr></table></figure>

<p>这是因为卸载时没有卸载干净, 我们进入&#x2F;var&#x2F;lib目录下删除文件夹pgsql就可以了</p>
<p>参考: <a href="https://blog.csdn.net/shirenkan/article/details/100903000">https://blog.csdn.net/shirenkan/article/details/100903000</a></p>
<h4 id="plsql配置"><a href="#plsql配置" class="headerlink" title="plsql配置"></a>plsql配置</h4><p>修改配置文件postgresql.conf – 允许远程访问</p>
<p>位置：&#x2F;var&#x2F;lib&#x2F;pgsql&#x2F;13&#x2F;data&#x2F;postgresql.conf<br>修改：使用vim打开配置文件, 使用&#x2F; + 关键字在编辑器中快速定位到listen(可以按N键查找下一个), 取消#注释或者新增一条 listen_addresses &#x3D; ‘*’ 表示允许所有ip访问</p>
<p>修改配置文件pg_hba.conf – 访问规则</p>
<p>位置：&#x2F;var&#x2F;lib&#x2F;pgsql&#x2F;13&#x2F;data&#x2F;pg_hba.conf</p>
<p>在IPv4 local connections:新增如下内容。其中192.168.0.0&#x2F;16 代表192.168.1.1到192.168.255.255都可以访问, 如果写成192.168.122.0&#x2F;24，代表192.168.122.1到192.168.122.255都可以访问</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="comment"># &quot;local&quot; is for Unix domain socket connections only</span></span><br><span class="line"><span class="attribute">local</span>   <span class="literal">all</span>             <span class="literal">all</span>                                     peer</span><br><span class="line"><span class="comment"># IPv4 local connections:</span></span><br><span class="line"><span class="attribute">host</span>    <span class="literal">all</span>             <span class="literal">all</span>             <span class="number">127.0.0.1</span>/<span class="number">32</span>            scram-sha-<span class="number">256</span></span><br><span class="line"><span class="comment"># 访问规则修改 允许所有端口连接</span></span><br><span class="line"><span class="attribute">host</span>    <span class="literal">all</span>             <span class="literal">all</span>             <span class="number">0.0.0.0</span>/<span class="number">0</span>               scram-sha-<span class="number">256</span></span><br><span class="line"><span class="comment"># IPv6 local connections:</span></span><br><span class="line"><span class="attribute">host</span>    <span class="literal">all</span>             <span class="literal">all</span>             ::<span class="number">1</span>/<span class="number">128</span>                 scram-sha-<span class="number">256</span></span><br><span class="line"><span class="comment"># Allow replication connections from localhost, by a user with the</span></span><br></pre></td></tr></table></figure>

<p>修改过后重启服务: <code>systemctl restart postgresql-13.service</code></p>
]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>postgresql</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux下网卡丢失找不到ens33问题</title>
    <url>/post/f6e594c0.html</url>
    <content><![CDATA[<p>虚拟机断电非正常关机后再开机后发现没网了，ifconfig查看发现网卡ens33没有了。一开始出现的问题是windows服务里的VMware Nat Service和Vmware DHCP服务未启动，我在尝试开启他们的时候报错。解决办法是在虚拟网络编辑器中恢复默认设置。</p>
<p><img src="/images/vmnet.png" alt="vmnet.png"></p>
<p>恢复完成后再次重启虚拟机问题还是没有解决。</p>
<p><code>systemctl status network</code> 查看服务状态发现抱错<code>Failed to start LSB: Bring up/down networking.</code> 重启服务会发现报如下错误</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">Job <span class="keyword">for</span> network.service failed because <span class="keyword">the</span> control <span class="built_in">process</span> exited <span class="keyword">with</span> error code. </span><br><span class="line">See <span class="string">&quot;systemctl status network.service&quot;</span> <span class="keyword">and</span> <span class="string">&quot;journalctl -xe&quot;</span> <span class="keyword">for</span> details.</span><br></pre></td></tr></table></figure>

<p>在网上找了很多方法，大都是让关闭NetworkManager这个服务，然后配置mac地址重启network服务。试了很多次还是差不多的错误一直没解决。</p>
<p>然后偶然看到一个命令nmcli，这是CentOS &#x2F; RHEL 7中的网络管理命令行工具，<a href="https://blog.csdn.net/wq1205750492/article/details/124497231">具体可见此篇</a>。</p>
<p>使用<code>nmcli device</code> 查看如下，发现ens33并没有被管理</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">DEVICE           <span class="keyword">TYPE</span>      <span class="type">STATE   </span>CONNECTION      </span><br><span class="line">ens33            ethernet  unmanaged  <span class="comment">--           </span></span><br><span class="line">br-be0e8c2a6f0e  bridge    unmanaged  <span class="comment">-- </span></span><br><span class="line">docker0          bridge    unmanaged  <span class="comment">--         </span></span><br><span class="line">tunl0            iptunnel  unmanaged  <span class="comment">--              </span></span><br><span class="line">dummy0           dummy     unmanaged  <span class="comment">--              </span></span><br><span class="line">kube-ipvs0       dummy     unmanaged  <span class="comment">--              </span></span><br><span class="line">cali213ddd9f079  ethernet  unmanaged  <span class="comment">--              </span></span><br><span class="line">cali79116ae6490  ethernet  unmanaged  <span class="comment">--              </span></span><br><span class="line">cali938c0c58be0  ethernet  unmanaged  <span class="comment">--              </span></span><br><span class="line">cali9adcc20a48c  ethernet  unmanaged  <span class="comment">--              </span></span><br><span class="line">caliaddbfd17901  ethernet  unmanaged  <span class="comment">--              </span></span><br><span class="line">calif809543b94d  ethernet  unmanaged  <span class="comment">--              </span></span><br><span class="line">veth1181ad1      ethernet  unmanaged  <span class="comment">--              </span></span><br><span class="line">veth428b509      ethernet  unmanaged  <span class="comment">--              </span></span><br><span class="line">veth5216903      ethernet  unmanaged  <span class="comment">--              </span></span><br><span class="line">veth73cff3d      ethernet  unmanaged  <span class="comment">--              </span></span><br><span class="line">vethba0bdfa      ethernet  unmanaged  <span class="comment">--              </span></span><br><span class="line">lo               loopback  unmanaged  <span class="comment">--</span></span><br></pre></td></tr></table></figure>

<p>使用命令<code>nmcli networking on</code>，再次查看发现ens33已经显示连接了</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">DEVICE           <span class="keyword">TYPE</span>      <span class="type">STATE   	   </span>CONNECTION      </span><br><span class="line">ens33            ethernet  connected   ens33           </span><br><span class="line">br-be0e8c2a6f0e  bridge    connected   br-be0e8c2a6f0e </span><br><span class="line">docker0          bridge    connected   docker0         </span><br><span class="line">tunl0            iptunnel  disconnect  <span class="comment">--              </span></span><br><span class="line">dummy0           dummy     unmanaged   <span class="comment">--              </span></span><br><span class="line">kube-ipvs0       dummy     unmanaged   <span class="comment">--              </span></span><br><span class="line">cali213ddd9f079  ethernet  unmanaged   <span class="comment">--              </span></span><br><span class="line">cali79116ae6490  ethernet  unmanaged   <span class="comment">--              </span></span><br><span class="line">cali938c0c58be0  ethernet  unmanaged   <span class="comment">--              </span></span><br><span class="line">cali9adcc20a48c  ethernet  unmanaged   <span class="comment">--              </span></span><br><span class="line">caliaddbfd17901  ethernet  unmanaged   <span class="comment">--              </span></span><br><span class="line">calif809543b94d  ethernet  unmanaged   <span class="comment">--              </span></span><br><span class="line">veth1181ad1      ethernet  unmanaged   <span class="comment">--              </span></span><br><span class="line">veth428b509      ethernet  unmanaged   <span class="comment">--              </span></span><br><span class="line">veth5216903      ethernet  unmanaged   <span class="comment">--              </span></span><br><span class="line">veth73cff3d      ethernet  unmanaged   <span class="comment">--              </span></span><br><span class="line">vethba0bdfa      ethernet  unmanaged   <span class="comment">--              </span></span><br><span class="line">lo               loopback  unmanaged   <span class="comment">--</span></span><br></pre></td></tr></table></figure>

<p>如果state为disconnect，请查看&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;(网卡配置文件)中，ONBOOT是否为yes。</p>
<p>再次重启服务，<code>systemctl restart network</code>，报错消失了。<code>systemctl status network</code> 查看服务，服务已经恢复正常。</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">● network.service - LSB: Bring up/down networking</span><br><span class="line">   Loaded: loaded (/etc/rc.d/init.d/network; bad; vendor preset: disabled)</span><br><span class="line">   Active: active (exited) since 三 <span class="number">2022</span>-<span class="number">08</span>-<span class="number">17</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">57</span> CST; <span class="number">1h</span> <span class="number">0m</span><span class="keyword">in</span> ago</span><br><span class="line">     Docs: man:systemd-sysv-generator(<span class="number">8</span>)</span><br><span class="line">  Process: <span class="number">47582</span> <span class="attr">ExecStop=</span>/etc/rc.d/init.d/network <span class="literal">stop</span> (<span class="attr">code=</span>exited, <span class="attr">status=</span><span class="number">0</span>/SUCCESS)</span><br><span class="line">  Process: <span class="number">47776</span> <span class="attr">ExecStart=</span>/etc/rc.d/init.d/network <span class="literal">start</span> (<span class="attr">code=</span>exited, <span class="attr">status=</span><span class="number">0</span>/SUCCESS)</span><br><span class="line"></span><br><span class="line"><span class="number">8</span>月 <span class="number">17</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">57</span> k8s-<span class="keyword">node</span><span class="title">-1</span> systemd[<span class="number">1</span>]: Starting LSB: Bring up/down networking...</span><br><span class="line"><span class="number">8</span>月 <span class="number">17</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">57</span> k8s-<span class="keyword">node</span><span class="title">-1</span> network[<span class="number">47776</span>]: 正在打开环回接口： [  确定  ]</span><br><span class="line"><span class="number">8</span>月 <span class="number">17</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">57</span> k8s-<span class="keyword">node</span><span class="title">-1</span> network[<span class="number">47776</span>]: 正在打开接口 ens33： 连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/<span class="number">2</span>）</span><br><span class="line"><span class="number">8</span>月 <span class="number">17</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">57</span> k8s-<span class="keyword">node</span><span class="title">-1</span> network[<span class="number">47776</span>]: [  确定  ]</span><br><span class="line"><span class="number">8</span>月 <span class="number">17</span> <span class="number">15</span>:<span class="number">11</span>:<span class="number">57</span> k8s-<span class="keyword">node</span><span class="title">-1</span> systemd[<span class="number">1</span>]: <span class="literal">Started</span> LSB: Bring up/down networking.</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>problem</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Welcome</title>
    <url>/post/f876582f.html</url>
    <content><![CDATA[<h4 id="你好啊，今天也是充满希望的一天！"><a href="#你好啊，今天也是充满希望的一天！" class="headerlink" title="你好啊，今天也是充满希望的一天！"></a>你好啊，今天也是充满希望的一天！</h4>]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>welcome</tag>
        <tag>github</tag>
      </tags>
  </entry>
  <entry>
    <title>k8s问题记录及解决</title>
    <url>/post/12766fb8.html</url>
    <content><![CDATA[<h4 id="1-K8S网络异常-CALICO报错"><a href="#1-K8S网络异常-CALICO报错" class="headerlink" title="1.K8S网络异常 CALICO报错"></a>1.K8S网络异常 CALICO报错</h4><p>报错如下:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Warning</span>  Unhealthy  <span class="number">3</span>m44s (x2400 over <span class="number">5</span>h57m)  kubelet  (combined from similar events): Readiness probe failed: <span class="number">2022</span>-<span class="number">07</span>-<span class="number">22</span> <span class="number">07</span>:<span class="number">15</span>:<span class="number">02</span>.<span class="number">196</span><span class="meta"> [INFO][81160] confd/health.go 180: Number of node(s) with BGP peering established = 0</span></span><br><span class="line"><span class="meta">calico/node is not ready: BIRD is not ready: BGP not established with 10.1.161.68,10.1.161.173</span></span><br></pre></td></tr></table></figure>

<p>首先看错误是由于无法连接到另外两个节点, 确保这两个节点正常的情况下, 错误还是没有解决。这是由于calico选择了错误的网卡导致的, calico的配置文件默认没有<strong>IP_AUTODETECTION_METHOD</strong> 配置项, 其默认值为<strong>first-found</strong>，这种模式中calico会使用第一获取到的有效网卡，虽然会排除docker网络，localhost啥的，但是在复杂网络环境下还是有出错的可能。在这次异常中master1上的calico选择了一个bridge网卡。</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">[root@k8s-<span class="literal">master</span>-<span class="number">1</span> calico]<span class="comment"># ip link</span></span><br><span class="line"><span class="number">1</span>: lo: <span class="tag">&lt;LOOPBACK,UP,LOWER_UP&gt;</span> mtu <span class="number">65536</span> qdisc noqueue state UNKNOWN mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> qlen <span class="number">1000</span> link/loopback <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> brd <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">2</span>: ens33: <span class="tag">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="number">1500</span> qdisc pfifo_fast state UP mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> qlen <span class="number">1000</span> link/ether <span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:<span class="number">19</span>:ff:<span class="number">01</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line"><span class="number">3</span>: br-<span class="number">2</span>b93787e0175: <span class="tag">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="number">1500</span> qdisc noqueue state UP mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> link/ether <span class="number">02</span>:<span class="number">42</span>:<span class="number">3</span>f:<span class="number">7</span>e:dc:<span class="number">80</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line"><span class="number">4</span>: docker0: <span class="tag">&lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt;</span> mtu <span class="number">1500</span> qdisc noqueue state DOWN mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> link/ether <span class="number">02</span>:<span class="number">42</span>:<span class="number">49</span>:b6:bc:f1 brd ff:ff:ff:ff:ff:ff</span><br><span class="line"><span class="number">526</span>: veth2d1d443@if525: <span class="tag">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="number">1500</span> qdisc noqueue <span class="keyword">master</span> <span class="title">br-2b93787e0175</span> state UP mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> link/ether f6:<span class="number">0</span>c:<span class="number">3</span>b:<span class="number">2</span>a:a2:<span class="number">02</span> brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">2</span></span><br><span class="line"><span class="number">528</span>: veth526ace8@if527: <span class="tag">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="number">1500</span> qdisc noqueue <span class="keyword">master</span> <span class="title">br-2b93787e0175</span> state UP mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> link/ether <span class="number">4</span>a:<span class="number">21</span>:<span class="number">33</span>:e2:<span class="number">3</span>d:<span class="number">39</span> brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">8</span></span><br><span class="line"><span class="number">530</span>: veth49ac40d@if529: <span class="tag">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="number">1500</span> qdisc noqueue <span class="keyword">master</span> <span class="title">br-2b93787e0175</span> state UP mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> link/ether a2:<span class="number">23</span>:<span class="number">7</span>b:<span class="number">25</span>:<span class="number">9</span>d:<span class="number">7</span>c brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">11</span></span><br><span class="line"><span class="number">18</span>: vethe51318e@if17: <span class="tag">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="number">1500</span> qdisc noqueue <span class="keyword">master</span> <span class="title">br-2b93787e0175</span> state UP mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> link/ether <span class="number">2</span>a:<span class="number">3</span>a:<span class="number">9</span>d:b1:<span class="number">88</span>:c3 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">0</span></span><br><span class="line"><span class="number">532</span>: vethc954704@if531: <span class="tag">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="number">1500</span> qdisc noqueue <span class="keyword">master</span> <span class="title">br-2b93787e0175</span> state UP mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> link/ether <span class="number">9</span>a:<span class="number">17</span>:d1:<span class="number">0</span>b:<span class="number">86</span>:<span class="number">84</span> brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">9</span></span><br><span class="line"><span class="number">20</span>: veth3985c2d@if19: <span class="tag">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="number">1500</span> qdisc noqueue <span class="keyword">master</span> <span class="title">br-2b93787e0175</span> state UP mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> link/ether <span class="number">5</span>e:b7:<span class="number">77</span>:d3:ec:<span class="number">27</span> brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">1</span></span><br><span class="line"><span class="number">534</span>: veth5b74bf7@if533: <span class="tag">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="number">1500</span> qdisc noqueue <span class="keyword">master</span> <span class="title">br-2b93787e0175</span> state UP mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> link/ether <span class="number">7</span>a:<span class="number">01</span>:ff:<span class="number">2</span>a:<span class="number">5</span>e:<span class="number">11</span> brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">10</span></span><br><span class="line"><span class="number">23</span>: dummy0: <span class="tag">&lt;BROADCAST,NOARP&gt;</span> mtu <span class="number">1500</span> qdisc noop state DOWN mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> qlen <span class="number">1000</span> link/ether <span class="number">46</span>:c9:a6:<span class="number">23</span>:<span class="number">00</span>:<span class="number">5</span>e brd ff:ff:ff:ff:ff:ff</span><br><span class="line"><span class="number">536</span>: vetha18f4f1@if535: <span class="tag">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="number">1500</span> qdisc noqueue <span class="keyword">master</span> <span class="title">br-2b93787e0175</span> state UP mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> link/ether <span class="number">6</span>a:be:f7:b6:<span class="number">9</span>c:<span class="number">69</span> brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">12</span></span><br><span class="line"><span class="number">24</span>: kube-ipvs0: <span class="tag">&lt;BROADCAST,NOARP&gt;</span> mtu <span class="number">1500</span> qdisc noop state DOWN mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> link/ether <span class="number">06</span>:<span class="number">42</span>:<span class="number">1</span>d:d4:<span class="number">33</span>:ff brd ff:ff:ff:ff:ff:ff</span><br><span class="line"><span class="number">25</span>: tunl0@NONE: <span class="tag">&lt;NOARP,UP,LOWER_UP&gt;</span> mtu <span class="number">1480</span> qdisc noqueue state UNKNOWN mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> qlen <span class="number">1000</span> link/ipip <span class="number">0.0</span>.<span class="number">0.0</span> brd <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"><span class="number">538</span>: veth43186a8@if537: <span class="tag">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="number">1500</span> qdisc noqueue <span class="keyword">master</span> <span class="title">br-2b93787e0175</span> state UP mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> link/ether aa:<span class="number">63</span>:<span class="number">11</span>:d4:<span class="number">94</span>:<span class="number">76</span> brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">13</span></span><br><span class="line"><span class="number">26</span>: cali213ddd9f079@if4: <span class="tag">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="number">1480</span> qdisc noqueue state UP mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> link/ether ee:ee:ee:ee:ee:ee brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">3</span></span><br><span class="line"><span class="number">27</span>: cali79116ae6490@if4: <span class="tag">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="number">1480</span> qdisc noqueue state UP mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> link/ether ee:ee:ee:ee:ee:ee brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">4</span></span><br><span class="line"><span class="number">28</span>: cali938c0c58be0@if4: <span class="tag">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="number">1480</span> qdisc noqueue state UP mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> link/ether ee:ee:ee:ee:ee:ee brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">5</span></span><br><span class="line"><span class="number">29</span>: caliaddbfd17901@if4: <span class="tag">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="number">1480</span> qdisc noqueue state UP mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> link/ether ee:ee:ee:ee:ee:ee brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">6</span></span><br><span class="line"><span class="number">30</span>: calif809543b94d@if4: <span class="tag">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="number">1480</span> qdisc noqueue state UP mode DEFAULT <span class="keyword">group</span> <span class="title">default</span> link/ether ee:ee:ee:ee:ee:ee brd ff:ff:ff:ff:ff:ff link-netnsid <span class="number">7</span></span><br><span class="line">[root@k8s-<span class="literal">master</span>-<span class="number">1</span> calico]<span class="comment"># </span></span><br></pre></td></tr></table></figure>

<p>可以看到我的网卡非常乱, 为了解决这种情况，IP_AUTODETECTION_METHOD还提供了两种配置can-reach&#x3D;DESTINATION，interface&#x3D;INTERFACE-REGEX。</p>
<p><strong>can-reach&#x3D;DESTINATION</strong>配置可以理解为calico会从部署节点路由中获取到达目的ip或者域名的源ip地址。例如</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Using IP addresses</span></span><br><span class="line"><span class="attr">IP_AUTODETECTION_METHOD</span>=can-reach=<span class="number">8.8</span>.<span class="number">8.8</span></span><br><span class="line"><span class="attr">IP6_AUTODETECTION_METHOD</span>=can-reach=<span class="number">2001</span>:<span class="number">4860</span>:<span class="number">4860</span>::<span class="number">8888</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Using domain names</span></span><br><span class="line"><span class="attr">IP_AUTODETECTION_METHOD</span>=can-reach=www.google.com</span><br><span class="line"><span class="attr">IP6_AUTODETECTION_METHOD</span>=can-reach=www.google.com</span><br></pre></td></tr></table></figure>

<p><strong>interface&#x3D;INTERFACE-REGEX</strong>配置可以指定calico使用匹配的网卡上的第一个IP地址。列出网卡和IP地址的顺序取决于系统。匹配支持goalong的正则语法。例如：</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Valid IP address on interface eth0, eth1, eth2 etc.</span></span><br><span class="line"><span class="attr">IP_AUTODETECTION_METHOD</span>=interface=eth.*</span><br><span class="line"><span class="attr">IP6_AUTODETECTION_METHOD</span>=interface=eth.*</span><br></pre></td></tr></table></figure>

<p>我的k8s节点网卡名称比较统一, 所以使用interface方法直接指定网卡名, 修改后的calico.yaml如下:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Choose the backend to use.</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_NETWORKING_BACKEND</span></span><br><span class="line">         <span class="attr">valueFrom:</span></span><br><span class="line">           <span class="attr">configMapKeyRef:</span></span><br><span class="line">             <span class="attr">name:</span> <span class="string">calico-config</span></span><br><span class="line">             <span class="attr">key:</span> <span class="string">calico_backend</span></span><br><span class="line">       <span class="comment"># Cluster type to identify the deployment type</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CLUSTER_TYPE</span></span><br><span class="line">         <span class="attr">value:</span> <span class="string">&quot;k8s,bgp&quot;</span></span><br><span class="line">       <span class="comment"># 解决网卡过多导致的calico-node找不到正确网卡的报错</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">IP_AUTODETECTION_METHOD</span></span><br><span class="line">         <span class="attr">value:</span> <span class="string">&quot;interface=ens33&quot;</span></span><br><span class="line">       <span class="comment"># Auto-detect the BGP IP address.</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">IP</span></span><br><span class="line">         <span class="attr">value:</span> <span class="string">&quot;autodetect&quot;</span></span><br><span class="line">       <span class="comment"># Enable IPIP</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_IPV4POOL_IPIP</span></span><br><span class="line">         <span class="attr">value:</span> <span class="string">&quot;Always&quot;</span></span><br><span class="line">       <span class="comment"># Enable or Disable VXLAN on the default IP pool.</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_IPV4POOL_VXLAN</span></span><br><span class="line">         <span class="attr">value:</span> <span class="string">&quot;Never&quot;</span></span><br><span class="line">       <span class="comment"># Enable or Disable VXLAN on the default IPv6 IP pool.</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_IPV6POOL_VXLAN</span></span><br><span class="line">         <span class="attr">value:</span> <span class="string">&quot;Never&quot;</span></span><br></pre></td></tr></table></figure>

<p>配置完成后kubectl apply -f calico.yaml 更新配置。再次查看calico节点状态，集群节点状态正常，集群恢复。</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">[root@k8s-master-<span class="number">1</span> calico]# kubectl <span class="built_in">get</span> pod -A -<span class="keyword">o</span> wide</span><br><span class="line">NAMESPACE              NAME                                         READY   STATUS    RESTARTS       AGE    IP              NODE           NOMINATED NODE   READINESS GATES</span><br><span class="line">kube-<span class="built_in">system</span>            calico-kube-controllers-<span class="number">6766647</span>d54-mv4np     <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">22</span> (<span class="number">40</span><span class="keyword">m</span> ago)   <span class="number">16</span>d    <span class="number">10.244</span>.<span class="number">196.45</span>   k8s-master-<span class="number">1</span>   <span class="symbol">&lt;none&gt;</span>           <span class="symbol">&lt;none&gt;</span></span><br><span class="line">kube-<span class="built_in">system</span>            calico-node-<span class="number">2</span>kz9b                            <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>              <span class="number">107</span>s   <span class="number">10.1</span>.<span class="number">161.30</span>     k8s-master-<span class="number">1</span>   <span class="symbol">&lt;none&gt;</span>           <span class="symbol">&lt;none&gt;</span></span><br><span class="line">kube-<span class="built_in">system</span>            calico-node-h52b6                            <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>              <span class="number">55</span>s    <span class="number">10.1</span>.<span class="number">161.68</span>     k8s-node-<span class="number">1</span>     <span class="symbol">&lt;none&gt;</span>           <span class="symbol">&lt;none&gt;</span></span><br><span class="line">kube-<span class="built_in">system</span>            calico-node-jw7r4                            <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">0</span>              <span class="number">107</span>s   <span class="number">10.1</span>.<span class="number">161.173</span>    k8s-node-<span class="number">2</span>     <span class="symbol">&lt;none&gt;</span>           <span class="symbol">&lt;none&gt;</span></span><br><span class="line">kube-<span class="built_in">system</span>            coredns-<span class="number">74586</span>cf9b6-<span class="number">45</span>zq4                     <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">16</span> (<span class="number">40</span><span class="keyword">m</span> ago)   <span class="number">16</span>d    <span class="number">10.244</span>.<span class="number">196.49</span>   k8s-master-<span class="number">1</span>   <span class="symbol">&lt;none&gt;</span>           <span class="symbol">&lt;none&gt;</span></span><br><span class="line">kube-<span class="built_in">system</span>            coredns-<span class="number">74586</span>cf9b6-wwxpc                     <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">15</span> (<span class="number">40</span><span class="keyword">m</span> ago)   <span class="number">16</span>d    <span class="number">10.244</span>.<span class="number">196.48</span>   k8s-master-<span class="number">1</span>   <span class="symbol">&lt;none&gt;</span>           <span class="symbol">&lt;none&gt;</span></span><br><span class="line">kube-<span class="built_in">system</span>            etcd-k8s-master-<span class="number">1</span>                            <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">15</span> (<span class="number">40</span><span class="keyword">m</span> ago)   <span class="number">21</span>d    <span class="number">10.1</span>.<span class="number">161.30</span>     k8s-master-<span class="number">1</span>   <span class="symbol">&lt;none&gt;</span>           <span class="symbol">&lt;none&gt;</span></span><br><span class="line">kube-<span class="built_in">system</span>            kube-apiserver-k8s-master-<span class="number">1</span>                  <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">24</span> (<span class="number">37</span><span class="keyword">m</span> ago)   <span class="number">21</span>d    <span class="number">10.1</span>.<span class="number">161.30</span>     k8s-master-<span class="number">1</span>   <span class="symbol">&lt;none&gt;</span>           <span class="symbol">&lt;none&gt;</span></span><br><span class="line">kube-<span class="built_in">system</span>            kube-controller-manager-k8s-master-<span class="number">1</span>         <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">29</span> (<span class="number">40</span><span class="keyword">m</span> ago)   <span class="number">21</span>d    <span class="number">10.1</span>.<span class="number">161.30</span>     k8s-master-<span class="number">1</span>   <span class="symbol">&lt;none&gt;</span>           <span class="symbol">&lt;none&gt;</span></span><br><span class="line">kube-<span class="built_in">system</span>            kube-proxy-bgp57                             <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">15</span> (<span class="number">40</span><span class="keyword">m</span> ago)   <span class="number">21</span>d    <span class="number">10.1</span>.<span class="number">161.30</span>     k8s-master-<span class="number">1</span>   <span class="symbol">&lt;none&gt;</span>           <span class="symbol">&lt;none&gt;</span></span><br><span class="line">kube-<span class="built_in">system</span>            kube-proxy-q6bp5                             <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">5</span> (<span class="number">129</span><span class="keyword">m</span> ago)   <span class="number">21</span>d    <span class="number">10.1</span>.<span class="number">161.173</span>    k8s-node-<span class="number">2</span>     <span class="symbol">&lt;none&gt;</span>           <span class="symbol">&lt;none&gt;</span></span><br><span class="line">kube-<span class="built_in">system</span>            kube-proxy-v5wdh                             <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">6</span> (<span class="number">130</span><span class="keyword">m</span> ago)   <span class="number">21</span>d    <span class="number">10.1</span>.<span class="number">161.68</span>     k8s-node-<span class="number">1</span>     <span class="symbol">&lt;none&gt;</span>           <span class="symbol">&lt;none&gt;</span></span><br><span class="line">kube-<span class="built_in">system</span>            kube-scheduler-k8s-master-<span class="number">1</span>                  <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">30</span> (<span class="number">40</span><span class="keyword">m</span> ago)   <span class="number">21</span>d    <span class="number">10.1</span>.<span class="number">161.30</span>     k8s-master-<span class="number">1</span>   <span class="symbol">&lt;none&gt;</span>           <span class="symbol">&lt;none&gt;</span></span><br><span class="line">kubernetes-dashboard   dashboard-metrics-scraper-<span class="number">7</span>bfdf779ff-mc5wb   <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">4</span> (<span class="number">40</span><span class="keyword">m</span> ago)    <span class="number">9</span>d     <span class="number">10.244</span>.<span class="number">196.47</span>   k8s-master-<span class="number">1</span>   <span class="symbol">&lt;none&gt;</span>           <span class="symbol">&lt;none&gt;</span></span><br><span class="line">kubernetes-dashboard   kubernetes-dashboard-d74db466-zgbbc          <span class="number">1</span>/<span class="number">1</span>     Running   <span class="number">5</span> (<span class="number">40</span><span class="keyword">m</span> ago)    <span class="number">9</span>d     <span class="number">10.244</span>.<span class="number">196.46</span>   k8s-master-<span class="number">1</span>   <span class="symbol">&lt;none&gt;</span>           <span class="symbol">&lt;none&gt;</span></span><br><span class="line">[root@k8s-master-<span class="number">1</span> calico]#</span><br></pre></td></tr></table></figure>

<blockquote>
<p>参考文档: <a href="https://www.freesion.com/article/9758557670/">https://www.freesion.com/article/9758557670/</a></p>
</blockquote>
]]></content>
      <categories>
        <category>problem</category>
      </categories>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title>springboot2.x在tomcat8上部署的问题</title>
    <url>/post/e87d47bf.html</url>
    <content><![CDATA[<p>最近公司在实行国产化开发, 项目部署用的是东方通(TongWeb)这个服务中间件, 这是一个基于tomcat开发的服务器.提供给我们使用的版本是基于tomcat8开发的, 比较老旧, 不出意外, 部署的时候报错了, 错误如下:</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">ERROR <span class="number">20324</span> --- <span class="literal">[<span class="identifier">http</span>-<span class="identifier">nio</span>-<span class="number">8080</span>-<span class="identifier">exec</span>-<span class="number">4</span>]</span> o.s.b.w.servlet.support.ErrorPageFilter  : Forwarding <span class="keyword">to</span> error page from request <span class="literal">[<span class="operator">/</span><span class="identifier">swagger</span>-<span class="identifier">resources</span>]</span> due <span class="keyword">to</span> <span class="keyword">exception</span> <span class="literal">[F<span class="identifier">ilter</span> 执行抛出一个异常]</span></span><br><span class="line"></span><br><span class="line">javax.servlet.ServletException: Filter 执行抛出一个异常</span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">ApplicationFilterChain</span>.</span></span>internal<span class="constructor">DoFilter(ApplicationFilterChain.<span class="params">java</span>:201)</span></span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">ApplicationFilterChain</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(ApplicationFilterChain.<span class="params">java</span>:167)</span></span><br><span class="line">	at com.citygis.business.core.filter.<span class="module-access"><span class="module"><span class="identifier">ValidationFilter</span>.</span></span><span class="keyword">do</span><span class="constructor">FilterInternal(ValidationFilter.<span class="params">java</span>:91)</span></span><br><span class="line">	at org.springframework.web.filter.<span class="module-access"><span class="module"><span class="identifier">OncePerRequestFilter</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(OncePerRequestFilter.<span class="params">java</span>:119)</span></span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">ApplicationFilterChain</span>.</span></span>internal<span class="constructor">DoFilter(ApplicationFilterChain.<span class="params">java</span>:194)</span></span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">ApplicationFilterChain</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(ApplicationFilterChain.<span class="params">java</span>:167)</span></span><br><span class="line">	at com.citygis.business.core.filter.<span class="module-access"><span class="module"><span class="identifier">JwtAuthenticationTokenFilter</span>.</span></span><span class="keyword">do</span><span class="constructor">FilterInternal(JwtAuthenticationTokenFilter.<span class="params">java</span>:62)</span></span><br><span class="line">	at org.springframework.web.filter.<span class="module-access"><span class="module"><span class="identifier">OncePerRequestFilter</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(OncePerRequestFilter.<span class="params">java</span>:119)</span></span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">ApplicationFilterChain</span>.</span></span>internal<span class="constructor">DoFilter(ApplicationFilterChain.<span class="params">java</span>:194)</span></span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">ApplicationFilterChain</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(ApplicationFilterChain.<span class="params">java</span>:167)</span></span><br><span class="line">	at com.alibaba.druid.support.http.<span class="module-access"><span class="module"><span class="identifier">WebStatFilter</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(WebStatFilter.<span class="params">java</span>:124)</span></span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">ApplicationFilterChain</span>.</span></span>internal<span class="constructor">DoFilter(ApplicationFilterChain.<span class="params">java</span>:194)</span></span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">ApplicationFilterChain</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(ApplicationFilterChain.<span class="params">java</span>:167)</span></span><br><span class="line">	at org.springframework.security.web.<span class="module-access"><span class="module"><span class="identifier">FilterChainProxy</span>.</span></span><span class="keyword">do</span><span class="constructor">FilterInternal(FilterChainProxy.<span class="params">java</span>:204)</span></span><br><span class="line">	at org.springframework.security.web.<span class="module-access"><span class="module"><span class="identifier">FilterChainProxy</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(FilterChainProxy.<span class="params">java</span>:183)</span></span><br><span class="line">	at org.springframework.web.filter.<span class="module-access"><span class="module"><span class="identifier">DelegatingFilterProxy</span>.</span></span>invoke<span class="constructor">Delegate(DelegatingFilterProxy.<span class="params">java</span>:358)</span></span><br><span class="line">	at org.springframework.web.filter.<span class="module-access"><span class="module"><span class="identifier">DelegatingFilterProxy</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(DelegatingFilterProxy.<span class="params">java</span>:271)</span></span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">ApplicationFilterChain</span>.</span></span>internal<span class="constructor">DoFilter(ApplicationFilterChain.<span class="params">java</span>:194)</span></span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">ApplicationFilterChain</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(ApplicationFilterChain.<span class="params">java</span>:167)</span></span><br><span class="line">	at org.springframework.web.filter.<span class="module-access"><span class="module"><span class="identifier">RequestContextFilter</span>.</span></span><span class="keyword">do</span><span class="constructor">FilterInternal(RequestContextFilter.<span class="params">java</span>:100)</span></span><br><span class="line">	at org.springframework.web.filter.<span class="module-access"><span class="module"><span class="identifier">OncePerRequestFilter</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(OncePerRequestFilter.<span class="params">java</span>:119)</span></span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">ApplicationFilterChain</span>.</span></span>internal<span class="constructor">DoFilter(ApplicationFilterChain.<span class="params">java</span>:194)</span></span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">ApplicationFilterChain</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(ApplicationFilterChain.<span class="params">java</span>:167)</span></span><br><span class="line">	at org.springframework.web.filter.<span class="module-access"><span class="module"><span class="identifier">FormContentFilter</span>.</span></span><span class="keyword">do</span><span class="constructor">FilterInternal(FormContentFilter.<span class="params">java</span>:93)</span></span><br><span class="line">	at org.springframework.web.filter.<span class="module-access"><span class="module"><span class="identifier">OncePerRequestFilter</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(OncePerRequestFilter.<span class="params">java</span>:119)</span></span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">ApplicationFilterChain</span>.</span></span>internal<span class="constructor">DoFilter(ApplicationFilterChain.<span class="params">java</span>:194)</span></span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">ApplicationFilterChain</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(ApplicationFilterChain.<span class="params">java</span>:167)</span></span><br><span class="line">	at org.springframework.boot.web.servlet.support.<span class="module-access"><span class="module"><span class="identifier">ErrorPageFilter</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(ErrorPageFilter.<span class="params">java</span>:126)</span></span><br><span class="line">	at org.springframework.boot.web.servlet.support.<span class="module-access"><span class="module"><span class="identifier">ErrorPageFilter</span>.</span></span>access<span class="constructor">$000(ErrorPageFilter.<span class="params">java</span>:64)</span></span><br><span class="line">	at org.springframework.boot.web.servlet.support.<span class="module-access"><span class="module"><span class="identifier">ErrorPageFilter$1</span>.</span></span><span class="keyword">do</span><span class="constructor">FilterInternal(ErrorPageFilter.<span class="params">java</span>:101)</span></span><br><span class="line">	at org.springframework.web.filter.<span class="module-access"><span class="module"><span class="identifier">OncePerRequestFilter</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(OncePerRequestFilter.<span class="params">java</span>:119)</span></span><br><span class="line">	at org.springframework.boot.web.servlet.support.<span class="module-access"><span class="module"><span class="identifier">ErrorPageFilter</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(ErrorPageFilter.<span class="params">java</span>:119)</span></span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">ApplicationFilterChain</span>.</span></span>internal<span class="constructor">DoFilter(ApplicationFilterChain.<span class="params">java</span>:194)</span></span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">ApplicationFilterChain</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(ApplicationFilterChain.<span class="params">java</span>:167)</span></span><br><span class="line">	at org.springframework.web.filter.<span class="module-access"><span class="module"><span class="identifier">CharacterEncodingFilter</span>.</span></span><span class="keyword">do</span><span class="constructor">FilterInternal(CharacterEncodingFilter.<span class="params">java</span>:201)</span></span><br><span class="line">	at org.springframework.web.filter.<span class="module-access"><span class="module"><span class="identifier">OncePerRequestFilter</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(OncePerRequestFilter.<span class="params">java</span>:119)</span></span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">ApplicationFilterChain</span>.</span></span>internal<span class="constructor">DoFilter(ApplicationFilterChain.<span class="params">java</span>:194)</span></span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">ApplicationFilterChain</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(ApplicationFilterChain.<span class="params">java</span>:167)</span></span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">StandardWrapperValve</span>.</span></span>invoke(<span class="module-access"><span class="module"><span class="identifier">StandardWrapperValve</span>.</span></span>java:<span class="number">202</span>)</span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">StandardContextValve</span>.</span></span>invoke(<span class="module-access"><span class="module"><span class="identifier">StandardContextValve</span>.</span></span>java:<span class="number">97</span>)</span><br><span class="line">	at org.apache.catalina.authenticator.<span class="module-access"><span class="module"><span class="identifier">AuthenticatorBase</span>.</span></span>invoke(<span class="module-access"><span class="module"><span class="identifier">AuthenticatorBase</span>.</span></span>java:<span class="number">544</span>)</span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">StandardHostValve</span>.</span></span>invoke(<span class="module-access"><span class="module"><span class="identifier">StandardHostValve</span>.</span></span>java:<span class="number">143</span>)</span><br><span class="line">	at org.apache.catalina.valves.<span class="module-access"><span class="module"><span class="identifier">ErrorReportValve</span>.</span></span>invoke(<span class="module-access"><span class="module"><span class="identifier">ErrorReportValve</span>.</span></span>java:<span class="number">81</span>)</span><br><span class="line">	at org.apache.catalina.valves.<span class="module-access"><span class="module"><span class="identifier">AbstractAccessLogValve</span>.</span></span>invoke(<span class="module-access"><span class="module"><span class="identifier">AbstractAccessLogValve</span>.</span></span>java:<span class="number">698</span>)</span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">StandardEngineValve</span>.</span></span>invoke(<span class="module-access"><span class="module"><span class="identifier">StandardEngineValve</span>.</span></span>java:<span class="number">78</span>)</span><br><span class="line">	at org.apache.catalina.connector.<span class="module-access"><span class="module"><span class="identifier">CoyoteAdapter</span>.</span></span>service(<span class="module-access"><span class="module"><span class="identifier">CoyoteAdapter</span>.</span></span>java:<span class="number">364</span>)</span><br><span class="line">	at org.apache.coyote.http11.<span class="module-access"><span class="module"><span class="identifier">Http11Processor</span>.</span></span>service(<span class="module-access"><span class="module"><span class="identifier">Http11Processor</span>.</span></span>java:<span class="number">624</span>)</span><br><span class="line">	at org.apache.coyote.<span class="module-access"><span class="module"><span class="identifier">AbstractProcessorLight</span>.</span></span>process(<span class="module-access"><span class="module"><span class="identifier">AbstractProcessorLight</span>.</span></span>java:<span class="number">65</span>)</span><br><span class="line">	at org.apache.coyote.<span class="module-access"><span class="module"><span class="identifier">AbstractProtocol$ConnectionHandler</span>.</span></span>process(<span class="module-access"><span class="module"><span class="identifier">AbstractProtocol</span>.</span></span>java:<span class="number">831</span>)</span><br><span class="line">	at org.apache.tomcat.util.net.<span class="module-access"><span class="module"><span class="identifier">NioEndpoint$SocketProcessor</span>.</span></span><span class="keyword">do</span><span class="constructor">Run(NioEndpoint.<span class="params">java</span>:1651)</span></span><br><span class="line">	at org.apache.tomcat.util.net.<span class="module-access"><span class="module"><span class="identifier">SocketProcessorBase</span>.</span></span>run(<span class="module-access"><span class="module"><span class="identifier">SocketProcessorBase</span>.</span></span>java:<span class="number">49</span>)</span><br><span class="line">	at java.util.concurrent.<span class="module-access"><span class="module"><span class="identifier">ThreadPoolExecutor</span>.</span></span>run<span class="constructor">Worker(ThreadPoolExecutor.<span class="params">java</span>:1149)</span></span><br><span class="line">	at java.util.concurrent.<span class="module-access"><span class="module"><span class="identifier">ThreadPoolExecutor$Worker</span>.</span></span>run(<span class="module-access"><span class="module"><span class="identifier">ThreadPoolExecutor</span>.</span></span>java:<span class="number">624</span>)</span><br><span class="line">	at org.apache.tomcat.util.threads.<span class="module-access"><span class="module"><span class="identifier">TaskThread$WrappingRunnable</span>.</span></span>run(<span class="module-access"><span class="module"><span class="identifier">TaskThread</span>.</span></span>java:<span class="number">61</span>)</span><br><span class="line">	at java.lang.<span class="module-access"><span class="module"><span class="identifier">Thread</span>.</span></span>run(<span class="module-access"><span class="module"><span class="identifier">Thread</span>.</span></span>java:<span class="number">748</span>)</span><br><span class="line">Caused by: java.lang.NoSuchMethodError: javax.servlet.http.<span class="module-access"><span class="module"><span class="identifier">HttpServletRequest</span>.</span></span>get<span class="constructor">HttpServletMapping()</span>Ljavax/servlet/http/HttpServletMapping;</span><br><span class="line">	at org.springframework.web.util.<span class="module-access"><span class="module"><span class="identifier">UrlPathHelper</span>.</span></span>skip<span class="constructor">ServletPathDetermination(UrlPathHelper.<span class="params">java</span>:265)</span></span><br><span class="line">	at org.springframework.web.util.<span class="module-access"><span class="module"><span class="identifier">UrlPathHelper</span>.</span></span>get<span class="constructor">LookupPathForRequest(UrlPathHelper.<span class="params">java</span>:250)</span></span><br><span class="line">	at org.springframework.web.cors.<span class="module-access"><span class="module"><span class="identifier">UrlBasedCorsConfigurationSource</span>.</span></span>resolve<span class="constructor">Path(UrlBasedCorsConfigurationSource.<span class="params">java</span>:260)</span></span><br><span class="line">	at org.springframework.web.cors.<span class="module-access"><span class="module"><span class="identifier">UrlBasedCorsConfigurationSource</span>.</span></span>get<span class="constructor">CorsConfiguration(UrlBasedCorsConfigurationSource.<span class="params">java</span>:244)</span></span><br><span class="line">	at org.springframework.web.filter.<span class="module-access"><span class="module"><span class="identifier">CorsFilter</span>.</span></span><span class="keyword">do</span><span class="constructor">FilterInternal(CorsFilter.<span class="params">java</span>:86)</span></span><br><span class="line">	at org.springframework.web.filter.<span class="module-access"><span class="module"><span class="identifier">OncePerRequestFilter</span>.</span></span><span class="keyword">do</span><span class="constructor">Filter(OncePerRequestFilter.<span class="params">java</span>:119)</span></span><br><span class="line">	at org.apache.catalina.core.<span class="module-access"><span class="module"><span class="identifier">ApplicationFilterChain</span>.</span></span>internal<span class="constructor">DoFilter(ApplicationFilterChain.<span class="params">java</span>:194)</span><span class="operator"></span></span><br><span class="line"><span class="operator">	... </span><span class="number">54</span> common frames omitted</span><br></pre></td></tr></table></figure>

<p>在使用tomcat9部署的时候并没有出现这个问题, 考虑是springboot版本和tomcat版本不对应导致的</p>
<p>解决办法: 去掉springboot自带的tomcat依赖并改为由tomcat容器提供(不然本地启动会由于没有容器而报错), 添加servlet依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>依赖中的scope属性设置为provided表示只在项目编译时提供此依赖, 并不会被打包, 由特定容器提供</p>
]]></content>
      <categories>
        <category>problem</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>springboot</tag>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>各数据库类似功能函数记录</title>
    <url>/post/19724609.html</url>
    <content><![CDATA[<h4 id="1-将多行的某个字段合并为一行"><a href="#1-将多行的某个字段合并为一行" class="headerlink" title="1. 将多行的某个字段合并为一行"></a>1. 将多行的某个字段合并为一行</h4><h5 id="1-1-mysql的group-concat-distinct-column-order-by-cloumn-separator-函数"><a href="#1-1-mysql的group-concat-distinct-column-order-by-cloumn-separator-函数" class="headerlink" title="1.1 mysql的group_concat([distinct] column [order by cloumn] [separator])函数"></a>1.1 mysql的<span style="color:red">group_concat([distinct] column [order by cloumn] [separator])</span>函数</h5><h5 id="1-2-oracle的listagg-within-group-函数"><a href="#1-2-oracle的listagg-within-group-函数" class="headerlink" title="1.2 oracle的listagg() within group ()函数"></a>1.2 oracle的<span style="color:red">listagg() within group ()</span>函数</h5><h5 id="postgresql的string-agg-expression-separator-order-by-clause-和array-agg-expression-order-by-sort-expression-asc-desc-…-函数"><a href="#postgresql的string-agg-expression-separator-order-by-clause-和array-agg-expression-order-by-sort-expression-asc-desc-…-函数" class="headerlink" title="postgresql的string_agg(expression, separator [order_by_clause])和array_agg(expression [order by [sort_expression {asc | desc}], […])函数"></a>postgresql的<span style="color:red">string_agg(expression, separator [order_by_clause])</span>和<span style="color:red">array_agg(expression [order by [sort_expression {asc | desc}], […])函数</span></h5>]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>postgresql</tag>
        <tag>oracle</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>换电脑后博客迁移</title>
    <url>/post/19844bb3.html</url>
    <content><![CDATA[<h4 id="得到博客文件夹"><a href="#得到博客文件夹" class="headerlink" title="得到博客文件夹"></a>得到博客文件夹</h4><p>文件可以从github上clone也可以从原电脑备份</p>
<p>建立hexo博客都会有一个独立的文件夹。电脑转移时安全的做法是将整个文件夹拷贝，这其中包括三个必备的文件：config.yml（站点配置_）、theme（主题文件夹）、source（博客内容文件）。次要文件：scaffolds（文章的模板）、package.json（使用包的说明文件）和.gitignore（限定在提交的时候哪些文件可以忽略）三个次要文件为自动生成的，因此丢失也不影响博客内容，后续在hexo init时会生成这三个文件。需要删除的文件：.git文件、node_modules（进行npm install会重新生成）、public（执行hexo g时会重新生成）、.deploy_git文件夹（执行hexo d时会重新生成）、db.json文件。其实上面这些可删除的文件即为.gitignore文件里面记载的可以忽略的内容。</p>
<h4 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h4><p>首先安装hexo</p>
<p>使用命令 <code>npm install -g hexo-cli</code></p>
<p>由于我们已经有了原博客的文件所以 <span style="color:red">不用执行 hexo init &lt;博客文件夹&gt;</span> 否则会初始化你原本博客的个性化设置</p>
<p>直接开始安装博客需要的一些组件</p>
<p>执行npm install,可能会出现两个警告, 不必理会</p>
<p>到这一步我们已经安装完成了, 接下来需要和我们的github仓库联系起来以便推送</p>
<h4 id="使用SSH-Key关联Github仓库"><a href="#使用SSH-Key关联Github仓库" class="headerlink" title="使用SSH Key关联Github仓库"></a>使用SSH Key关联Github仓库</h4><p>如果还能找到以前使用的ssh key, 那可以把原来的key文件复制到新电脑继续使用 key文件夹.ssh一般在C盘的用户目录下</p>
<p>找不回的话就需要新生成key文件, 使用命令: <code>ssh-keygen -t rsa -C &quot;你的邮箱地址&quot;</code>来生成新的ssh key文件</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">注意： GitHub 在 <span class="number">2022</span> 年 <span class="number">3</span> 月 <span class="number">15</span> 日通过删除较旧的不安全密钥类型提高了安全性。</span><br><span class="line"></span><br><span class="line">从该日期起，不再支持 DSA 密钥 (ssh-dss)。 您无法将新 DSA 密钥添加到您在 GitHub.com 上的个人帐户。</span><br><span class="line"></span><br><span class="line">在 <span class="number">2021</span> 年 <span class="number">11</span> 月 <span class="number">2</span> 日之前 valid_after 的 RSA 密钥 (ssh-rsa) 可以继续使用任何签名算法。 在该日期之后生成的 RSA 密钥必须使用 SHA-<span class="number">2</span> 签名算法。 某些较旧的客户端可能需要升级才能使用 SHA-<span class="number">2</span> 签名。</span><br><span class="line"></span><br><span class="line">受支持的秘钥类型为: </span><br><span class="line">id_rsa.<span class="keyword">pub</span></span><br><span class="line">id_ecdsa.<span class="keyword">pub</span></span><br><span class="line">id_ed25519.<span class="keyword">pub</span></span><br><span class="line"></span><br><span class="line">$ ssh-keygen -t ed25519 -C <span class="string">&quot;your_email@example.com&quot;</span></span><br><span class="line">Note: If you are using a legacy system that doesn<span class="symbol">&#x27;t</span> support the Ed25519 algorithm, <span class="keyword">use</span>:</span><br><span class="line">$ ssh-keygen -t rsa -b <span class="number">4096</span> -C <span class="string">&quot;your_email@example.com&quot;</span></span><br></pre></td></tr></table></figure>

<p>这里使用rsa模式, 接下来会出现如下提示: </p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">&gt; Generating <span class="keyword">public</span>/<span class="keyword">private</span> rsa key pair.</span><br><span class="line">&gt; Enter a <span class="keyword">file</span> in which to save the key (<span class="regexp">/c/U</span>sers<span class="regexp">/you/</span>.ssh/id_rsa):[Press enter]</span><br></pre></td></tr></table></figure>

<p>直接回车, 使用默认路径就好, 接下来会出现: </p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">&gt; Enter passphrase (empty <span class="keyword">for</span> no passphrase): [<span class="keyword">Type</span> <span class="type">a </span>passphrase]</span><br><span class="line">&gt; Enter same passphrase again: [<span class="keyword">Type</span> <span class="type">passphrase </span>again]</span><br></pre></td></tr></table></figure>

<p>要求你输入密码，这个密码会在你提交项目时使用，如果为空的话提交项目时则不用输入。这个设置是防止别人往你的项目里提交内容。</p>
<p>注意：输入密码的时候没有*字样的，直接输入就好。<br>然后会显示关于新生成key的一些信息, 到此ssh key生成完成</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">Your identification has been saved in /C/Users/Night/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /C/Users/Night/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">65:58:······02:4b emailname<span class="meta">@email.com</span></span><br><span class="line">The key&#x27;s randomart image is:</span><br><span class="line">+--[ RSA 2048]----+</span><br><span class="line">|<span class="string">                 </span>|</span><br><span class="line">|<span class="string">       .   o .   </span>|</span><br><span class="line">|<span class="string">    . o o = o    </span>|</span><br><span class="line">|<span class="string">   . o * = o     </span>|</span><br><span class="line">|<span class="string">  E  o + o .     </span>|</span><br><span class="line">|<span class="string"> . o.   . .      </span>|</span><br><span class="line">|<span class="string">     ..          </span>|</span><br><span class="line">+-----------------+</span><br></pre></td></tr></table></figure>

<h4 id="在Github添加SSH-Key"><a href="#在Github添加SSH-Key" class="headerlink" title="在Github添加SSH Key"></a>在Github添加SSH Key</h4><p>登录github, 在个人头像处点击设置, 然后找到SSH and GPG keys, 点击新建SSH Key</p>
<p>找到我们刚才生成的key文件夹, 用编辑器打开id_rsa.pub文件并复制全部内容</p>
<p>将复制的内容粘贴到新建框内, title可以随便写, 然后点击保存</p>
<p>测试一下是否添加成功: <code>ssh -T git@github.com</code></p>
<p>有可能会出现：</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">The</span> authenticity of host &#x27;github.com (<span class="number">192</span>.<span class="number">168</span>.***.<span class="number">111</span>)&#x27; can&#x27;t be established.</span><br><span class="line"><span class="attribute">RSA</span> key fingerprint is <span class="number">36</span>:<span class="number">27</span>:ac:a5:<span class="number">76</span>:<span class="number">28</span>:<span class="number">2</span>d:<span class="number">45</span>:<span class="number">63</span>:<span class="number">1</span>b:<span class="number">56</span>:<span class="number">4</span>d:eb:df:a6:<span class="number">48</span>.</span><br><span class="line"><span class="attribute">Are</span> you sure you want to continue connecting (yes/no)?</span><br></pre></td></tr></table></figure>

<p>或者是</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">The authenticity of host &#x27;github.com (192.168.<span class="strong">**<span class="emphasis">*.111)&#x27; can&#x27;t be established.</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">RSA key fingerprint is nThbg*</span>**</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span>8.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)?</span><br></pre></td></tr></table></figure>

<p>这种情况下，直接 yes 回车。然后会出现：</p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line">如果设置了密码会要求输入密码</span><br><span class="line">Enter passphrase <span class="keyword">for</span> <span class="keyword">key</span> <span class="comment">&#x27;/c/Users/csdl2/.ssh/id_rsa&#x27;:</span></span><br><span class="line">Hi username! You<span class="comment">&#x27;ve successfully authenticated, but GitHub does not provide shell access.</span></span><br></pre></td></tr></table></figure>

<p>如果出现如下错误:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">xxx<span class="meta">@github</span>.com: Permission <span class="title function_">denied</span> <span class="params">(publickey)</span>.</span><br></pre></td></tr></table></figure>

<p>这是因为测试的时候使用了其他用户名导致, 请使用<a href="mailto:&#103;&#x69;&#116;&#64;&#103;&#x69;&#116;&#104;&#117;&#x62;&#x2e;&#99;&#x6f;&#x6d;">&#103;&#x69;&#116;&#64;&#103;&#x69;&#116;&#104;&#117;&#x62;&#x2e;&#99;&#x6f;&#x6d;</a>来测试</p>
<h4 id="设置Git用户信息"><a href="#设置Git用户信息" class="headerlink" title="设置Git用户信息"></a>设置Git用户信息</h4><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">$ git config <span class="attr">--global</span> user<span class="selector-class">.name</span> <span class="string">&quot;用户名&quot;</span></span><br><span class="line">$ git config <span class="attr">--global</span> user<span class="selector-class">.email</span>  <span class="string">&quot;邮箱&quot;</span></span><br></pre></td></tr></table></figure>

<p>到此迁移完成, 继续愉快的学习吧</p>
<p>参考: <code>https://blog.csdn.net/qq_34187711/article/details/88592760</code></p>
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>使用富文本编辑器Ueditor是遇到的小问题</title>
    <url>/post/61622d0e.html</url>
    <content><![CDATA[<h4 id="关于Ueditor"><a href="#关于Ueditor" class="headerlink" title="关于Ueditor:"></a>关于Ueditor:</h4><p>​	Ueditor在初始化时会先发送一次请求来获取config.json这个配置文件, 请求路径在ueditor.config.js中, 这个路径可以根据自己的需要自定义, 一般为: ip:port&#x2F;ueditor&#x2F;jsp&#x2F;config.json。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 配置项主体。注意，此处所有涉及到路径的配置别遗漏URL变量。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="variable language_">window</span>.<span class="property">UEDITOR_CONFIG</span> = &#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//为编辑器实例添加一个路径，这个不能被注释</span></span><br><span class="line">       <span class="attr">UEDITOR_HOME_URL</span>: <span class="variable constant_">URL</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">// 服务器统一请求接口路径</span></span><br><span class="line">       , <span class="attr">serverUrl</span>: <span class="string">&quot;/upload/config&quot;</span></span><br></pre></td></tr></table></figure>

<p>​	但是如果是前后端分离项目中涉及到跨域问题, ueditor使用的是jsonp, 这时如果从后台请求json文件就会出问题, 因为json和jsonp格式是不一样的, 我的处理办法是请求config.json文件时直接在前台获取, 第二次请求上传时才会请求后台, 这就需要自己定义图片的上传路径。</p>
<p>​	后台代码如下:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">upload</span><span class="params">(HttpServletResponse response, String action, MultipartFile upfile)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	<span class="comment">//action为发送请求是附带的动作表示请求的类型是什么</span></span><br><span class="line">    <span class="keyword">if</span> (action.equals(<span class="string">&quot;config&quot;</span>)) &#123;</span><br><span class="line">        response.sendRedirect(<span class="string">&quot;/ueditor/jsp/config.json&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;file = &quot;</span> + upfile);</span><br><span class="line">        <span class="keyword">if</span> (upfile == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> QiNiuFilesUtil.uploadFilesQinu(upfile);</span><br><span class="line">        System.out.println(<span class="string">&quot;filePath = &quot;</span> + filePath);</span><br><span class="line">        <span class="comment">//ueditor要求返回格式</span></span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//state成功必须返回SUCCESS</span></span><br><span class="line">        map.put(<span class="string">&quot;state&quot;</span>, <span class="string">&quot;SUCCESS&quot;</span>);</span><br><span class="line">        <span class="comment">//图片地址，/ueditor/jsp/config.json配置中配置的图片前缀为&quot;http://&quot;,所以这里返回完成地址</span></span><br><span class="line">        map.put(<span class="string">&quot;url&quot;</span>, filePath);</span><br><span class="line">        <span class="comment">//返回json</span></span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        response.setContentType(<span class="string">&quot;application/json; charset=utf-8&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            out = response.getWriter();</span><br><span class="line">            out.append(JSON.toJSONString(map));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (out != <span class="literal">null</span>) &#123;</span><br><span class="line">                out.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>problem</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>ueditor</tag>
      </tags>
  </entry>
</search>
